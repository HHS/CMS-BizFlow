-- CMS_HR_DB_UPD_22_FN_GET_NAMES.sql 

create or replace FUNCTION FN_GET_NAMES
(
	I_IDS              IN  NVARCHAR2	
)
RETURN NVARCHAR2
IS
	V_RETURN_VAL	NVARCHAR2(600);
	V_VALUE1	NVARCHAR2(10);
	V_VALUE2	NVARCHAR2(10);
	V_VALUE3	NVARCHAR2(10);
	V_NAME1		NVARCHAR2(200);
	V_NAME2		NVARCHAR2(200);
	V_NAME3		NVARCHAR2(200);

BEGIN
	--DBMS_OUTPUT.PUT_LINE('------- START: FN_GET_NAMES -------');
	--DBMS_OUTPUT.PUT_LINE('-- PARAMETERS --');
	--DBMS_OUTPUT.PUT_LINE('    I_IDS         = ' || I_IDS );
	IF I_IDS IS NOT NULL THEN
		SELECT REGEXP_SUBSTR (I_IDS, '[^,]+', 1, 1) INTO V_VALUE1 FROM DUAL;
		SELECT REGEXP_SUBSTR (I_IDS, '[^,]+', 1, 2) INTO V_VALUE2 FROM DUAL;
		SELECT REGEXP_SUBSTR (I_IDS, '[^,]+', 1, 3) INTO V_VALUE3 FROM DUAL;
	END IF;

	IF V_VALUE1 IS NOT NULL THEN
		SELECT M.NAME INTO V_NAME1 FROM BIZFLOW.MEMBER M WHERE M.MEMBERID = V_VALUE1 AND ROWNUM = 1;
		V_RETURN_VAL := V_NAME1;
	END IF;

	IF V_VALUE2 IS NOT NULL THEN
		SELECT M.NAME INTO V_NAME2 FROM BIZFLOW.MEMBER M WHERE M.MEMBERID = V_VALUE2 AND ROWNUM = 1;
		V_RETURN_VAL := V_RETURN_VAL || ';' || V_NAME2;
	END IF;

	IF V_VALUE3 IS NOT NULL THEN
		SELECT M.NAME INTO V_NAME3 FROM BIZFLOW.MEMBER M WHERE M.MEMBERID = V_VALUE3 AND ROWNUM = 1;
		V_RETURN_VAL := V_RETURN_VAL || ';' || V_NAME3;
	END IF;

	--DBMS_OUTPUT.PUT_LINE('    V_RETURN_VAL = ' || V_RETURN_VAL);
	--DBMS_OUTPUT.PUT_LINE('------- END: FN_GET_NAMES -------');
	RETURN V_RETURN_VAL;

EXCEPTION
	WHEN OTHERS THEN
		SP_ERROR_LOG();
		--DBMS_OUTPUT.PUT_LINE('ERROR occurred while executing FN_GET_SUBORG_CD -------------------');
		--DBMS_OUTPUT.PUT_LINE('Error code    = ' || SQLCODE);
		--DBMS_OUTPUT.PUT_LINE('Error message = ' || SQLERRM);
		RETURN NULL;
END;

/
